
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Converter &#8212; NengoDL 3.4.3 docs</title>
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/basic.css" type="text/css" />
<link href="https://fonts.googleapis.com/css?family=IBM+Plex+Sans:400,400i,600|Rajdhani:700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css" integrity="sha384-oS3vJWv+0UjzBfQzYUhtDYW+Pj2yciDJxpsK1OYPAYjqT085Qq/1cq5FLXAZQ7Ay" crossorigin="anonymous">
<link rel="stylesheet" href="https://www.nengo.ai/css/bootstrap.css" type="text/css">
<style>
  body .title-bar,
  body .documentation-source h1:after {
    background-color: #ff6600;
  }
</style>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-GT8XEDLTMJ"></script>
<script>
 window.dataLayer = window.dataLayer || [];
 function gtag(){dataLayer.push(arguments);}
 gtag('js', new Date());
 gtag('config', 'G-GT8XEDLTMJ');
</script>
<!-- End Google tag (gtag.js) -->

<!-- Matomo -->
<script>
 var _paq = window._paq = window._paq || [];
 _paq.push(["setDocumentTitle", document.domain + "/" + document.title]);
 _paq.push(["setCookieDomain", "*.appliedbrainresearch.com"]);
 _paq.push(["setDomains", ["*.appliedbrainresearch.com","*.edge.nengo.ai","*.forum.nengo.ai","*.labs.nengo.ai","*.nengo.ai"]]);
 _paq.push(["enableCrossDomainLinking"]);
 _paq.push(["setDoNotTrack", true]);
 _paq.push(['trackPageView']);
 _paq.push(['enableLinkTracking']);
 (function() {
   var u="https://appliedbrainresearch.matomo.cloud/";
   _paq.push(['setTrackerUrl', u+'matomo.php']);
   _paq.push(['setSiteId', '3']);
   var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
   g.async=true; g.src='//cdn.matomo.cloud/appliedbrainresearch.matomo.cloud/matomo.js'; s.parentNode.insertBefore(g,s);
 })();
</script>
<!-- End Matomo Code -->
<script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
<script src="https://unpkg.com/scrollreveal"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/stickyfill/2.1.0/stickyfill.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js" integrity="sha384-smHYKdLADwkXOn1EmN1qk/HfnUcbVRZyYmZ4qpPea6sjB/pTJ0euyQp0Mk8ck+5T" crossorigin="anonymous"></script>
<!-- From basic/layout.html -->
<script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
  
  
<script src="_static/underscore.js"></script>
  
  
<script src="_static/doctools.js"></script>
  
  
<script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
  
    <link rel="shortcut icon" href="_static/favicon.ico"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Configuration options" href="config.html" />
    <link rel="prev" title="TensorNodes" href="tensor-node.html" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">

  </head><body class="bg-dark">

<header class="fixed-top header-top shadow-sm">
  <nav class="navbar navbar-expand-md navbar-light bg-white">
    <a class="navbar-brand" href="https://www.nengo.ai/">
      <img
        src="https://www.nengo.ai/design/_images/general-full-light.svg"
        alt="Nengo"
        class="logo"
      />
    </a>
    <button
      class="navbar-toggler"
      type="button"
      data-toggle="collapse"
      data-target="#navbar-collapse"
      aria-controls="navbar-collapse"
      aria-expanded="false"
      aria-label="Toggle navigation"
    >
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbar-collapse">
      <ul class="navbar-nav ml-auto">
        <li class="nav-item">
          <a class="nav-link" href="https://www.nengo.ai/">What is Nengo?</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://www.nengo.ai/examples/">Examples</a>
        </li>
        <li class="nav-item dropdown active">
          <a
            class="nav-link dropdown-toggle"
            id="navbar-dropdown-docs"
            data-toggle="dropdown"
            aria-haspopup="true"
            aria-expanded="false"
            href="#"
            >Documentation</a
          >
          <div
            class="dropdown-menu shadow-lg border-0"
            aria-labelledby="navbar-dropdown-docs"
          >
            
            <a class="dropdown-item" href="https://www.nengo.ai/nengo/">Nengo core</a>
            <a class="dropdown-item" href="https://github.com/nengo/nengo-gui/">NengoGUI</a>
            <a class="dropdown-item" href="https://www.nengo.ai/nengo-dl/">NengoDL</a>
            <div class="dropdown-divider"></div>
            <a class="dropdown-item" href="https://www.nengo.ai/nengo-spa/">NengoSPA</a>
            <a class="dropdown-item" href="https://www.nengo.ai/nengo-extras/">NengoExtras</a>
            <a class="dropdown-item" href="https://arvoelke.github.io/nengolib-docs/">Nengolib</a>
            <a class="dropdown-item" href="https://www.nengo.ai/keras-spiking">KerasSpiking</a>
            <a class="dropdown-item" href="https://www.nengo.ai/pytorch-spiking">PyTorchSpiking</a>
            <div class="dropdown-divider"></div>
            <a class="dropdown-item" href="https://www.nengo.ai/nengo-fpga/">NengoFPGA</a>
            <a class="dropdown-item" href="https://www.nengo.ai/nengo-loihi/">NengoLoihi</a>
            <a class="dropdown-item" href="https://labs.nengo.ai/nengo-ocl/">NengoOCL</a>
            <a class="dropdown-item" href="https://github.com/project-rig/nengo_spinnaker">NengoSpiNNaker</a>
            <a class="dropdown-item" href="https://github.com/nengo-labs/nengo-mpi">NengoMPI</a>
            <div class="dropdown-divider"></div>
            <a class="dropdown-item" href="https://www.nengo.ai/documentation/"
              >All documentation</a
            >
          </div>
        </li>
        <li class="nav-item dropdown">
          <a
            class="nav-link dropdown-toggle"
            id="navbar-dropdown-community"
            data-toggle="dropdown"
            aria-haspopup="true"
            aria-expanded="false"
            href="#"
            >Community</a
          >
          <div
            class="dropdown-menu shadow-lg border-0"
            aria-labelledby="navbar-dropdown-community"
          >
            <a class="dropdown-item" href="https://forum.nengo.ai">Forum</a>
            <div class="dropdown-divider"></div>
            <a class="dropdown-item" href="https://www.nengo.ai/people/"
              >People</a
            >
            <a class="dropdown-item" href="https://www.nengo.ai/summer-school/"
              >Summer school</a
            >
            <a class="dropdown-item" href="https://www.nengo.ai/contributing/"
              >Contributing</a
            >
            <a class="dropdown-item" href="https://www.nengo.ai/publications/"
              >Publications</a
            >
            <a class="dropdown-item" href="https://www.nengo.ai/videos/"
              >Videos</a
            >
            <a class="dropdown-item" href="https://www.nengo.ai/conduct/"
              >Code of conduct</a
            >
            <a class="dropdown-item" href="https://www.nengo.ai/caa/">CAA</a>
          </div>
        </li>
        <li class="nav-item">
          <a
            class="nav-link btn btn-success btn-sm text-white"
            href="https://www.nengo.ai/getting-started/"
            >Getting started</a
          >
        </li>
      </ul>
    </div>
  </nav>
</header>
<div class="main-content gradient-top">
  <div class="container-fluid">
    <div class="row"><a class="toggle-sidenav d-block d-md-none" href="#"
  ><i class="icon-close fa fa-fw fa-arrow-left"></i
  ><i class="icon-open fa fa-fw fa-arrow-right"></i
></a>
<div role="complementary" class="sidenav col-4 col-xl-3 p-0 border-right">
  <h3 class="pt-5 px-5">
    <a href="index.html">
      <img
        class="img-fluid documentation-image"
        src="https://www.nengo.ai/design/_images/nengo-dl-full-light.svg"
        alt="NengoDL"
      />
    </a>
  </h3>
<form class="px-5 py-3 my-0 border-bottom" action="search.html" method="get">
  <div class="form-group form-group-single">
    <input type="text" name="q" class="form-control" placeholder="Search" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
    <button type="submit" class="btn btn-link">
      <img src="https://www.nengo.ai/img/icon-search.svg" alt="Go" />
    </button>
  </div>
</form><div class="p-5 toctree">
  
    <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="user-guide.html">User guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="simulator.html">NengoDL Simulator</a></li>
<li class="toctree-l2"><a class="reference internal" href="tensor-node.html">TensorNodes</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Converter</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#extending-the-converter">Extending the converter</a></li>
<li class="toctree-l3"><a class="reference internal" href="#examples">Examples</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="config.html">Configuration options</a></li>
<li class="toctree-l2"><a class="reference internal" href="tips.html">Tips and tricks</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="reference.html">API reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="resources.html">Additional resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="project.html">Project information</a></li>
</ul>

  
  </div>
  
  <form class="p-5 my-0 border-top">
    <div class="form-group">
      <label class="text-gray">Version:</label>
      <select class="custom-select" onchange="switchVersion(this);">
        
        
        <option value="../converter.html">latest</option>
        
        
          
        <option selected>v3.4.3</option>
          
        
          
        <option value="../v3.4.2/converter.html">
          v3.4.2
        </option>
          
        
          
        <option value="../v3.4.1/converter.html">
          v3.4.1
        </option>
          
        
          
        <option value="../v3.4.0/converter.html">
          v3.4.0
        </option>
          
        
          
        <option value="../v3.3.0/converter.html">
          v3.3.0
        </option>
          
        
          
        <option value="../v3.2.0/converter.html">
          v3.2.0
        </option>
          
        
          
        <option value="../v3.1.0/converter.html">
          v3.1.0
        </option>
          
        
          
        <option value="../v3.0.0/converter.html">
          v3.0.0
        </option>
          
        
          
        <option value="../v2.2.2/converter.html">
          v2.2.2
        </option>
          
        
          
        <option value="../v2.2.1/converter.html">
          v2.2.1
        </option>
          
        
          
        <option value="../v2.2.0/converter.html">
          v2.2.0
        </option>
          
        
          
        <option value="../v2.1.1/converter.html">
          v2.1.1
        </option>
          
        
          
        <option value="../v2.1.0/converter.html">
          v2.1.0
        </option>
          
        
          
        <option value="../v2.0.0/converter.html">
          v2.0.0
        </option>
          
        
          
        <option value="../v1.2.1/converter.html">
          v1.2.1
        </option>
          
        
          
        <option value="../v1.2.0/converter.html">
          v1.2.0
        </option>
          
        
          
        <option value="../v1.1.0/converter.html">
          v1.1.0
        </option>
          
        
          
        <option value="../v1.0.0/converter.html">
          v1.0.0
        </option>
          
        
          
        <option value="../v0.6.2/converter.html">
          v0.6.2
        </option>
          
        
          
        <option value="../v0.6.1/converter.html">
          v0.6.1
        </option>
          
        
          
        <option value="../v0.6.0/converter.html">
          v0.6.0
        </option>
          
        
          
        <option value="../v0.5.2/converter.html">
          v0.5.2
        </option>
          
        
          
        <option value="../v0.5.1/converter.html">
          v0.5.1
        </option>
          
        
          
        <option value="../v0.5.0/converter.html">
          v0.5.0
        </option>
          
        
          
        <option value="../v0.4.0/converter.html">
          v0.4.0
        </option>
          
        
          
        <option value="../v0.3.1/converter.html">
          v0.3.1
        </option>
          
        
          
        <option value="../v0.3.0/converter.html">
          v0.3.0
        </option>
          
        
          
        <option value="../v0.2.0/converter.html">
          v0.2.0
        </option>
          
        
      </select>
    </div>
  </form>
  
</div>
      

      <div class="col-12 col-md-8 col-xl-9">
        <div class="container">
          <div class="row">
            <div class="col-10 offset-1 pb-5 documentation-source" role="main">
              
              
  <div class="section" id="converter">
<h1>Converter<a class="headerlink" href="#converter" title="Permalink to this headline">¶</a></h1>
<p>NengoDL allows Keras models to be integrated directly into a NengoDL network, through
the use of <a class="reference internal" href="reference.html#nengo_dl.TensorNode" title="nengo_dl.TensorNode"><code class="xref py py-obj docutils literal notranslate"><span class="pre">nengo_dl.TensorNode</span></code></a> (see <a class="reference internal" href="examples/tensorflow-models.html"><span class="doc">this example</span></a>).
However, rather than keeping a model defined in Keras/TensorFlow, sometimes we may
want to convert it to a native Nengo model
(composed only of Nengo objects, such as <a class="reference external" href="https://www.nengo.ai/nengo/frontend-api.html#nengo.Ensemble" title="(in Nengo v3.2)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">nengo.Ensemble</span></code></a> and <a class="reference external" href="https://www.nengo.ai/nengo/frontend-api.html#nengo.Connection" title="(in Nengo v3.2)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">nengo.Connection</span></code></a>). One
reason we might want to do this is if we want to be able to run the model on different
Nengo backends. Keras models can only run in the NengoDL Simulator, but a native Nengo
model can run in any Nengo Simulator (including backends for specialized neuromorphic
hardware).  Another reason we might want to convert a Keras model to a Nengo network
is so that we can use Nengo’s spiking neuron types rather than the standard
Keras/TensorFlow activation functions.</p>
<p>Whatever the motivation, the <a class="reference internal" href="reference.html#nengo_dl.Converter" title="nengo_dl.Converter"><code class="xref py py-obj docutils literal notranslate"><span class="pre">nengo_dl.Converter</span></code></a> tool is designed to automate the
translation from Keras to Nengo as much as possible.  To use it, simply instantiate a
Keras model and then pass it to the Converter:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">inp</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Input</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">28</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="n">conv</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Conv2D</span><span class="p">(</span><span class="n">filters</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">relu</span><span class="p">)(</span><span class="n">inp</span><span class="p">)</span>
<span class="n">flat</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Flatten</span><span class="p">()(</span><span class="n">conv</span><span class="p">)</span>
<span class="n">dense</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">relu</span><span class="p">)(</span><span class="n">flat</span><span class="p">)</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">inputs</span><span class="o">=</span><span class="n">inp</span><span class="p">,</span> <span class="n">outputs</span><span class="o">=</span><span class="n">dense</span><span class="p">)</span>

<span class="n">converter</span> <span class="o">=</span> <span class="n">nengo_dl</span><span class="o">.</span><span class="n">Converter</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
</pre></div>
</div>
<p>The <a class="reference internal" href="reference.html#nengo_dl.Converter" title="nengo_dl.Converter"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Converter</span></code></a> object will have a <code class="docutils literal notranslate"><span class="pre">.net</span></code> attribute which is the converted Nengo
network. This can then be passed to a Nengo Simulator. For example, we could run that
converted Keras network in the standard Nengo (not NengoDL) Simulator:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">nengo</span><span class="o">.</span><span class="n">Simulator</span><span class="p">(</span><span class="n">converter</span><span class="o">.</span><span class="n">net</span><span class="p">)</span> <span class="k">as</span> <span class="n">sim</span><span class="p">:</span>
    <span class="n">sim</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
</pre></div>
</div>
<p>The converter also has <code class="docutils literal notranslate"><span class="pre">.inputs</span></code> and <code class="docutils literal notranslate"><span class="pre">.outputs</span></code> attributes which can be used
to look up the Nengo Nodes/Probes corresponding to the Keras model inputs/outputs.
For example, to see the output of the converted network:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">sim</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">converter</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">output</span><span class="p">]])</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[[0. 0. 0. 0. 0. 0. 0. 0. 0. 0.]]
</pre></div>
</div>
<p><a class="reference internal" href="reference.html#nengo_dl.Converter" title="nengo_dl.Converter"><code class="xref py py-obj docutils literal notranslate"><span class="pre">nengo_dl.Converter</span></code></a> has many options that control different aspects of the conversion
process.  For example, we could change all the <code class="docutils literal notranslate"><span class="pre">tf.nn.relu</span></code> activation functions
in the Keras model to spiking neurons:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">converter</span> <span class="o">=</span> <span class="n">nengo_dl</span><span class="o">.</span><span class="n">Converter</span><span class="p">(</span>
    <span class="n">model</span><span class="p">,</span> <span class="n">swap_activations</span><span class="o">=</span><span class="p">{</span><span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">relu</span><span class="p">:</span> <span class="n">nengo</span><span class="o">.</span><span class="n">SpikingRectifiedLinear</span><span class="p">()})</span>
</pre></div>
</div>
<p>We will not go into all the available options here; see the
<a class="reference internal" href="reference.html#nengo_dl.Converter" title="nengo_dl.Converter"><code class="xref py py-obj docutils literal notranslate"><span class="pre">API</span> <span class="pre">docs</span></code></a> for more details.</p>
<p>Keep in mind that the Converter is designed to automate the translation process as much
as possible, but it will not work for all possible Keras networks. In general, the
Converter will fall back to using TensorNodes for any elements that cannot be converted
to native Nengo objects (set <code class="docutils literal notranslate"><span class="pre">allow_fallback=False</span></code> if you would like this to be an
error instead).  The <a class="reference internal" href="reference.html#nengo_dl.Converter.verify" title="nengo_dl.Converter.verify"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Converter.verify</span></code></a> function can be used to check that the output
of the Nengo network matches the output of the Keras model.</p>
<div class="section" id="extending-the-converter">
<h2>Extending the converter<a class="headerlink" href="#extending-the-converter" title="Permalink to this headline">¶</a></h2>
<p>Since we know that it will not be possible to automatically translate all possible
Keras models, the Converter has been designed to be easily extensible. So if you have
a model containing elements that the Converter does not know how to translate,
you can augment the Converter with custom conversion logic.</p>
<p>For example, suppose we have a model containing a custom Keras layer:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">AddOne</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Layer</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">inputs</span> <span class="o">+</span> <span class="mi">1</span>

<span class="n">inp</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Input</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,))</span>
<span class="n">dense</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="mi">10</span><span class="p">)(</span><span class="n">inp</span><span class="p">)</span>
<span class="n">addone</span> <span class="o">=</span> <span class="n">AddOne</span><span class="p">()(</span><span class="n">dense</span><span class="p">)</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">inputs</span><span class="o">=</span><span class="n">inp</span><span class="p">,</span> <span class="n">outputs</span><span class="o">=</span><span class="n">addone</span><span class="p">)</span>
</pre></div>
</div>
<p><a class="reference internal" href="reference.html#nengo_dl.Converter" title="nengo_dl.Converter"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Converter</span></code></a> would fail to convert this model to native Nengo objects, since it does
not know how to translate the <code class="docutils literal notranslate"><span class="pre">AddOne</span></code> layer:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">converter</span> <span class="o">=</span> <span class="n">nengo_dl</span><span class="o">.</span><span class="n">Converter</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">allow_fallback</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Traceback (most recent call last):
...
TypeError: Unable to convert layer add_one to native Nengo objects
</pre></div>
</div>
<p>We could set <code class="docutils literal notranslate"><span class="pre">allow_fallback=True</span></code> to use a <a class="reference internal" href="reference.html#nengo_dl.TensorNode" title="nengo_dl.TensorNode"><code class="xref py py-obj docutils literal notranslate"><span class="pre">TensorNode</span></code></a> to implement the <code class="docutils literal notranslate"><span class="pre">AddOne</span></code>
layer, but suppose we want to use native Nengo objects instead. We need to make a custom
<a class="reference internal" href="reference.html#nengo_dl.converter.LayerConverter" title="nengo_dl.converter.LayerConverter"><code class="xref py py-obj docutils literal notranslate"><span class="pre">nengo_dl.converter.LayerConverter</span></code></a> subclass, which contains the logic for translating
an <code class="docutils literal notranslate"><span class="pre">AddOne</span></code> layer.  Note that this may require some knowledge of how Keras layers work
under the hood, which is not extensively documented. Your best bet may be to look at
the existing <a class="reference internal" href="reference.html#layer-converter-api"><span class="std std-ref">LayerConverter classes</span></a> to find a similar
Layer type to start from.</p>
<p>As an example, here is how we might translate the <code class="docutils literal notranslate"><span class="pre">AddOne</span></code> layer:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@nengo_dl</span><span class="o">.</span><span class="n">Converter</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">AddOne</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">ConvertAddOne</span><span class="p">(</span><span class="n">nengo_dl</span><span class="o">.</span><span class="n">converter</span><span class="o">.</span><span class="n">LayerConverter</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">convert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_id</span><span class="p">):</span>
        <span class="c1"># create a Nengo object representing the output of this layer node</span>
        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_nengo_obj</span><span class="p">(</span><span class="n">node_id</span><span class="p">)</span>

        <span class="c1"># connect up the input of the layer node</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_connection</span><span class="p">(</span><span class="n">node_id</span><span class="p">,</span> <span class="n">output</span><span class="p">)</span>

        <span class="c1"># create a node to output a constant 1 vector</span>
        <span class="n">bias</span> <span class="o">=</span> <span class="n">nengo</span><span class="o">.</span><span class="n">Node</span><span class="p">([</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">output</span><span class="o">.</span><span class="n">size_in</span><span class="p">)</span>

        <span class="c1"># connect up the bias node to the output (thereby adding one to the</span>
        <span class="c1"># input values)</span>
        <span class="n">conn</span> <span class="o">=</span> <span class="n">nengo</span><span class="o">.</span><span class="n">Connection</span><span class="p">(</span><span class="n">bias</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="n">synapse</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

        <span class="c1"># mark the above connection as non-trainable (since we didn&#39;t have any</span>
        <span class="c1"># trainable parameters in the AddOne layer, we don&#39;t want any in the</span>
        <span class="c1"># converted Nengo equivalent either)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_trainable</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">output</span>
</pre></div>
</div>
<p>And now if we try to convert the original Keras model, we can see that it is
successfully transformed into a native Nengo network:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">converter</span> <span class="o">=</span> <span class="n">nengo_dl</span><span class="o">.</span><span class="n">Converter</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">allow_fallback</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">converter</span><span class="o">.</span><span class="n">verify</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="examples">
<h2>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p><a class="reference internal" href="examples/keras-to-snn.html"><span class="doc">Converting a Keras model to a spiking neural network</span></a></p></li>
<li><p><a class="reference internal" href="examples/tensorflow-models.html"><span class="doc">Integrating a Keras model into a Nengo network</span></a></p></li>
</ul>
</div>
</div>


            </div>
          </div>
        </div>
      </div>

    </div>
  </div>
</div><footer class="text-light footer-main gradient-bottom">
  <p class="small text-center mb-0">
    <a class="no-hover-line" href="https://appliedbrainresearch.com">
      <img
        src="https://appliedbrainresearch.com/img/logo-blue-notext.svg"
        height="48"
      />
    </a>
    <a href="https://www.nengo.ai/">What is Nengo?</a>
    <a href="https://www.nengo.ai/examples/">Examples</a>
    <a href="https://www.nengo.ai/documentation/">Documentation</a>
    <a href="https://www.nengo.ai/getting-started/">Getting started</a>
    <a href="https://www.nengo.ai/privacy/">Privacy</a>
  </p>
  <p class="small text-center mb-0">&copy; Applied Brain Research</p>
</footer>
<script>
  function switchVersion(select) {
    var option = select.selectedOptions[0];
    if (option.hasAttribute("value")) {
      window.location = option.value;
    }
  }
</script>

<script>
  var elements = document.querySelectorAll('.sidenav');
  Stickyfill.add(elements);
</script>
<script>
  ScrollReveal().reveal(".fade-in", {
      scale: 0.85,
      duration: 1000,
      delay: 250,
      interval: 50
  });
</script>
<script>
  $('a.toggle-sidenav').on('click', function(e) {
    e.preventDefault();
    if ( $(this).hasClass('active') ) {
      $(this).removeClass('active');
      $('.sidenav').removeClass('open');
    } else {
      $(this).addClass('active');
      $('.sidenav').addClass('open');
    }
  });
</script>
<script>
  var lists = document.querySelectorAll('.toctree ul');
  lists.forEach((ul) => {
      ul.classList.add("nav");
  });
  var links = document.querySelectorAll('.toctree a');
  links.forEach((link) => {
      link.classList.add("nav-link");
  });
  $("body").scrollspy({target: ".sidenav"});
</script>
  </body>
</html>