
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>TensorNodes &#8212; NengoDL 2.2.1 docs</title>
    <link rel="stylesheet" href="_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
<link href="https://fonts.googleapis.com/css?family=IBM+Plex+Sans:400,400i,600|Rajdhani:700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css" integrity="sha384-oS3vJWv+0UjzBfQzYUhtDYW+Pj2yciDJxpsK1OYPAYjqT085Qq/1cq5FLXAZQ7Ay" crossorigin="anonymous">
<link rel="stylesheet" href="https://www.nengo.ai/css/bootstrap.css" type="text/css">
<style>
  body .title-bar,
  body .documentation-source h1:after {
    background-color: #ff6600;
  }
</style>

<!-- Google Tag Manager -->
<script>
 (function (w, d, s, l, i) {
   w[l] = w[l] || [];
   w[l].push({ "gtm.start": new Date().getTime(), event: "gtm.js" });
   var f = d.getElementsByTagName(s)[0],
       j = d.createElement(s),
       dl = l != "dataLayer" ? "&l=" + l : "";
   j.async = true;
   j.src = "https://www.googletagmanager.com/gtm.js?id=" + i + dl;
   f.parentNode.insertBefore(j, f);
 })(window, document, "script", "dataLayer", "GTM-KWCR2HN");
</script>
<!-- End Google Tag Manager -->
<script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
<script src="https://unpkg.com/scrollreveal"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/stickyfill/2.1.0/stickyfill.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js" integrity="sha384-smHYKdLADwkXOn1EmN1qk/HfnUcbVRZyYmZ4qpPea6sjB/pTJ0euyQp0Mk8ck+5T" crossorigin="anonymous"></script>
<!-- From basic/layout.html -->
<script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
  
  
<script type="text/javascript" src="_static/underscore.js"></script>
  
  
<script type="text/javascript" src="_static/doctools.js"></script>
  
  
<script type="text/javascript" src="_static/language_data.js"></script>
  
  
<script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
  
  
<script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
  
  
<script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
  
    <link rel="shortcut icon" href="_static/favicon.ico"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Configuration options" href="config.html" />
    <link rel="prev" title="Optimizing a NengoDL model" href="training.html" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">

  </head><body class="bg-dark">

<header class="fixed-top header-top shadow-sm">
  <nav class="navbar navbar-expand-md navbar-light bg-white">
    <a class="navbar-brand" href="https://www.nengo.ai/">
      <img
        src="https://www.nengo.ai/design/_images/general-full-light.svg"
        alt="Nengo"
        class="logo"
      />
    </a>
    <button
      class="navbar-toggler"
      type="button"
      data-toggle="collapse"
      data-target="#navbar-collapse"
      aria-controls="navbar-collapse"
      aria-expanded="false"
      aria-label="Toggle navigation"
    >
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbar-collapse">
      <ul class="navbar-nav ml-auto">
        <li class="nav-item">
          <a class="nav-link" href="https://www.nengo.ai/">What is Nengo?</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://www.nengo.ai/examples/">Examples</a>
        </li>
        <li class="nav-item dropdown active">
          <a
            class="nav-link dropdown-toggle"
            id="navbar-dropdown-docs"
            data-toggle="dropdown"
            aria-haspopup="true"
            aria-expanded="false"
            href="#"
            >Documentation</a
          >
          <div
            class="dropdown-menu shadow-lg border-0"
            aria-labelledby="navbar-dropdown-docs"
          >
            
            <a class="dropdown-item" href="https://www.nengo.ai/nengo/">Nengo Core</a>
            <a class="dropdown-item" href="https://github.com/nengo/nengo-gui/">Nengo GUI</a>
            <a class="dropdown-item" href="https://www.nengo.ai/nengo-dl/">Nengo DL</a>
            <div class="dropdown-divider"></div>
            <a class="dropdown-item" href="https://www.nengo.ai/nengo-spa/">Nengo SPA</a>
            <a class="dropdown-item" href="https://www.nengo.ai/nengo-extras/">Nengo Extras</a>
            <a class="dropdown-item" href="https://arvoelke.github.io/nengolib-docs/">Nengolib</a>
            <div class="dropdown-divider"></div>
            <a class="dropdown-item" href="https://www.nengo.ai/nengo-fpga/">Nengo FPGA</a>
            <a class="dropdown-item" href="https://www.nengo.ai/nengo-loihi/">Nengo Loihi</a>
            <a class="dropdown-item" href="https://github.com/nengo/nengo-ocl">Nengo OpenCL</a>
            <a class="dropdown-item" href="https://github.com/project-rig/nengo_spinnaker">Nengo SpiNNaker</a>
            <a class="dropdown-item" href="https://github.com/nengo/nengo-mpi">Nengo MPI</a>
            <div class="dropdown-divider"></div>
            <a class="dropdown-item" href="https://www.nengo.ai/documentation/"
              >All documentation</a
            >
          </div>
        </li>
        <li class="nav-item dropdown">
          <a
            class="nav-link dropdown-toggle"
            id="navbar-dropdown-community"
            data-toggle="dropdown"
            aria-haspopup="true"
            aria-expanded="false"
            href="#"
            >Community</a
          >
          <div
            class="dropdown-menu shadow-lg border-0"
            aria-labelledby="navbar-dropdown-community"
          >
            <a class="dropdown-item" href="https://forum.nengo.ai">Forum</a>
            <div class="dropdown-divider"></div>
            <a class="dropdown-item" href="https://www.nengo.ai/people/"
              >People</a
            >
            <a class="dropdown-item" href="https://www.nengo.ai/summer-school/"
              >Summer school</a
            >
            <a class="dropdown-item" href="https://www.nengo.ai/contributing/"
              >Contributing</a
            >
            <a class="dropdown-item" href="https://www.nengo.ai/publications/"
              >Publications</a
            >
            <a class="dropdown-item" href="https://www.nengo.ai/videos/"
              >Videos</a
            >
            <a class="dropdown-item" href="https://www.nengo.ai/conduct/"
              >Code of conduct</a
            >
            <a class="dropdown-item" href="https://www.nengo.ai/caa/">CAA</a>
          </div>
        </li>
        <li class="nav-item">
          <a
            class="nav-link btn btn-success btn-sm text-white"
            href="https://www.nengo.ai/getting-started/"
            >Getting started</a
          >
        </li>
      </ul>
    </div>
  </nav>
</header>
<div class="main-content gradient-top">
  <div class="container-fluid">
    <div class="row"><a class="toggle-sidenav d-block d-md-none" href="#"
  ><i class="icon-close fa fa-fw fa-arrow-left"></i
  ><i class="icon-open fa fa-fw fa-arrow-right"></i
></a>
<div role="complementary" class="sidenav col-4 col-xl-3 p-0 border-right">
  <h3 class="pt-5 px-5">
    <a href="index.html">
      <img
        class="img-fluid documentation-image"
        src="https://www.nengo.ai/design/_images/nengo-dl-full-light.svg"
        alt="NengoDL"
      />
    </a>
  </h3>
  
  <form class="px-5 pb-5 mb-0 mt-3 border-bottom">
    <div class="form-group">
      <label class="text-gray">Version:</label>
      <select class="custom-select" onchange="switchVersion(this);">
        
        
        <option value="../tensor-node.html">latest</option>
        
        
          
        <option selected>v2.2.1</option>
          
        
          
        <option value="../v2.2.0/tensor-node.html">
          v2.2.0
        </option>
          
        
          
        <option value="../v2.1.1/tensor-node.html">
          v2.1.1
        </option>
          
        
          
        <option value="../v2.1.0/tensor-node.html">
          v2.1.0
        </option>
          
        
          
        <option value="../v2.0.0/tensor-node.html">
          v2.0.0
        </option>
          
        
          
        <option value="../v1.2.1/tensor-node.html">
          v1.2.1
        </option>
          
        
          
        <option value="../v1.2.0/tensor-node.html">
          v1.2.0
        </option>
          
        
          
        <option value="../v1.1.0/tensor-node.html">
          v1.1.0
        </option>
          
        
          
        <option value="../v1.0.0/tensor-node.html">
          v1.0.0
        </option>
          
        
          
        <option value="../v0.6.2/tensor-node.html">
          v0.6.2
        </option>
          
        
          
        <option value="../v0.6.1/tensor-node.html">
          v0.6.1
        </option>
          
        
          
        <option value="../v0.6.0/tensor-node.html">
          v0.6.0
        </option>
          
        
          
        <option value="../v0.5.2/tensor-node.html">
          v0.5.2
        </option>
          
        
          
        <option value="../v0.5.1/tensor-node.html">
          v0.5.1
        </option>
          
        
          
        <option value="../v0.5.0/tensor-node.html">
          v0.5.0
        </option>
          
        
          
        <option value="../v0.4.0/tensor-node.html">
          v0.4.0
        </option>
          
        
          
        <option value="../v0.3.1/tensor-node.html">
          v0.3.1
        </option>
          
        
          
        <option value="../v0.3.0/tensor-node.html">
          v0.3.0
        </option>
          
        
          
        <option value="../v0.2.0/tensor-node.html">
          v0.2.0
        </option>
          
        
      </select>
    </div>
  </form>
  
  <div class="p-5 toctree">
    <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="user-guide.html">User guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="simulator.html">NengoDL Simulator</a></li>
<li class="toctree-l2"><a class="reference internal" href="training.html">Optimizing a NengoDL model</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">TensorNodes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#examples">Examples</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="config.html">Configuration options</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="reference.html">API reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="resources.html">Additional resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="project.html">Project information</a></li>
</ul>

  </div>
<form class="p-5 my-0 border-top" action="search.html" method="get">
  <div class="form-group form-group-single">
    <input type="text" name="q" class="form-control" placeholder="Search" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
    <button type="submit" class="btn btn-link">
      <img src="https://www.nengo.ai/img/icon-search.svg" alt="Go" />
    </button>
  </div>
</form></div>
      

      <div class="col-12 col-md-8 col-xl-9">
        <div class="container">
          <div class="row">
            <div class="col-10 offset-1 pb-5 documentation-source" role="main">
              
  <div class="section" id="tensornodes">
<h1>TensorNodes<a class="headerlink" href="#tensornodes" title="Permalink to this headline">¶</a></h1>
<p>TensorNodes allow parts of a model to be defined using TensorFlow and smoothly
integrated with the rest of a Nengo model.  TensorNodes work very similarly to
a regular <a class="reference external" href="https://www.nengo.ai/nengo/frontend_api.html#nengo.Node" title="(in Nengo v3.0)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Node</span></code></a>, except instead of executing arbitrary
Python code they execute arbitrary TensorFlow code.</p>
<p>The TensorFlow code is defined in a function or callable class
(<code class="docutils literal notranslate"><span class="pre">tensor_func</span></code>).  This function accepts the current simulation time as
input, or the current simulation time and a Tensor <code class="docutils literal notranslate"><span class="pre">x</span></code> if
<code class="docutils literal notranslate"><span class="pre">node.size_in</span> <span class="pre">&gt;</span> <span class="pre">0</span></code>.  <code class="docutils literal notranslate"><span class="pre">x</span></code> will have shape
<code class="docutils literal notranslate"><span class="pre">(sim.minibatch_size,</span> <span class="pre">node.size_in</span></code>), and the function should return a
Tensor with shape <code class="docutils literal notranslate"><span class="pre">(sim.minibatch_size,</span> <span class="pre">node.size_out)</span></code>.
<code class="docutils literal notranslate"><span class="pre">node.size_out</span></code> will be inferred by calling the function once and
checking the output, if it isn’t set when the Node is created.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">tensor_func</span><span class="p">(</span><span class="n">t</span> <span class="p">[,</span> <span class="n">x</span><span class="p">]):</span>
    <span class="k">print</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>  <span class="c1"># current simulation time</span>
    <span class="k">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>  <span class="c1"># input on current timestep (minibatch_size, node.size_in)</span>

    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span>
</pre></div>
</div>
<p>If <code class="docutils literal notranslate"><span class="pre">tensor_func</span></code> has a <code class="docutils literal notranslate"><span class="pre">pre_build</span></code> attribute, that function will be
called once when the model is constructed.  This can be used to compute any
constant values or set up variables – things that don’t need to
execute every simulation timestep.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">pre_build</span><span class="p">(</span><span class="n">shape_in</span><span class="p">,</span> <span class="n">shape_out</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="n">shape_in</span><span class="p">)</span>  <span class="c1"># (minibatch_size, node.size_in)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">shape_out</span><span class="p">)</span>  <span class="c1"># (minibatch_size, node.size_out)</span>
</pre></div>
</div>
<p>If <code class="docutils literal notranslate"><span class="pre">tensor_func</span></code> has a <code class="docutils literal notranslate"><span class="pre">post_build</span></code> attribute, that function will be
called after the simulator is created and whenever it is reset.  This can
be used to set any random elements in the TensorNode or perform any
post-initialization setup required by the node (e.g., loading pretrained
weights).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">post_build</span><span class="p">(</span><span class="n">sess</span><span class="p">,</span> <span class="n">rng</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="n">sess</span><span class="p">)</span>  <span class="c1"># the TensorFlow simulation session object</span>
    <span class="k">print</span><span class="p">(</span><span class="n">rng</span><span class="p">)</span>  <span class="c1"># random number generator (np.random.RandomState)</span>
</pre></div>
</div>
<p><a class="reference internal" href="reference.html#nengo_dl.tensor_node.tensor_layer" title="nengo_dl.tensor_node.tensor_layer"><code class="xref py py-obj docutils literal notranslate"><span class="pre">tensor_layer</span></code></a> is a utility function for constructing TensorNodes,
designed to mimic the layer-based model construction style of many deep
learning packages.  It combines the creation of a <a class="reference internal" href="reference.html#nengo_dl.tensor_node.TensorNode" title="nengo_dl.tensor_node.TensorNode"><code class="xref py py-obj docutils literal notranslate"><span class="pre">TensorNode</span></code></a> or
<a class="reference external" href="https://www.nengo.ai/nengo/frontend_api.html#nengo.Ensemble" title="(in Nengo v3.0)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Ensemble</span></code></a> and a <a class="reference external" href="https://www.nengo.ai/nengo/frontend_api.html#nengo.Connection" title="(in Nengo v3.0)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Connection</span></code></a> in a single step.</p>
<p>See the <a class="reference internal" href="reference.html#tensornode-api"><span class="std std-ref">TensorNode API</span></a> for more details, or the
examples below for demonstrations of using TensorNodes in practice.</p>
<div class="section" id="examples">
<h2>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p><a class="reference internal" href="examples/from-nengo.html"><span class="doc">Coming from Nengo to NengoDL</span></a></p></li>
<li><p><a class="reference internal" href="examples/from-tensorflow.html"><span class="doc">Coming from TensorFlow to NengoDL</span></a></p></li>
<li><p><a class="reference internal" href="examples/tensorflow-models.html"><span class="doc">Inserting a TensorFlow/Keras network into a Nengo model</span></a></p></li>
<li><p><a class="reference internal" href="examples/spiking-mnist.html"><span class="doc">Optimizing spiking neural networks</span></a></p></li>
</ul>
</div>
</div>


            </div>
          </div>
        </div>
      </div>

    </div>
  </div>
</div><footer class="text-light footer-main gradient-bottom">
  <p class="small text-center mb-0">
    <a class="no-hover-line" href="https://appliedbrainresearch.com">
      <img
        src="https://appliedbrainresearch.com/img/logo-blue-notext.svg"
        height="48"
      />
    </a>
    <a href="https://www.nengo.ai/">What is Nengo?</a>
    <a href="https://www.nengo.ai/examples/">Examples</a>
    <a href="https://www.nengo.ai/documentation/">Documentation</a>
    <a href="https://www.nengo.ai/getting-started/">Getting started</a>
    <a href="https://www.nengo.ai/privacy/">Privacy</a>
  </p>
  <p class="small text-center mb-0">&copy; Applied Brain Research</p>
</footer>
<script>
  function switchVersion(select) {
    var option = select.selectedOptions[0];
    if (option.hasAttribute("value")) {
      window.location = option.value;
    }
  }
</script>

<script>
  var elements = document.querySelectorAll('.sidenav');
  Stickyfill.add(elements);
</script>
<script>
  ScrollReveal().reveal(".fade-in", {
      scale: 0.85,
      duration: 1000,
      delay: 250,
      interval: 50
  });
</script>
<script>
  $('a.toggle-sidenav').on('click', function(e) {
    e.preventDefault();
    if ( $(this).hasClass('active') ) {
      $(this).removeClass('active');
      $('.sidenav').removeClass('open');
    } else {
      $(this).addClass('active');
      $('.sidenav').addClass('open');
    }
  });
</script>
<script>
  var lists = document.querySelectorAll('.toctree ul');
  lists.forEach((ul) => {
      ul.classList.add("nav");
  });
  var links = document.querySelectorAll('.toctree a');
  links.forEach((link) => {
      link.classList.add("nav-link");
  });
  $("body").scrollspy({target: ".sidenav"});
</script>
  </body>
</html>