

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>TensorNodes &mdash; NengoDL 0.3.0 docs</title>
  

  
  
  
  

  

  
  
    

  

  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static\custom.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Optimizing a NengoDL model" href="training.html" />
    <link rel="prev" title="NengoDL Simulator" href="simulator.html" /> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> NengoDL
          

          
          </a>

          
            
            
              <div class="version">
                0.3
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="frontend.html">User API</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="simulator.html">NengoDL Simulator</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">TensorNodes</a></li>
<li class="toctree-l2"><a class="reference internal" href="training.html">Optimizing a NengoDL model</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="resources.html">Additional resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="backend.html">Developer API</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">NengoDL</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
          <li><a href="frontend.html">User API</a> &raquo;</li>
        
      <li>TensorNodes</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/tensor_node.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="tensornodes">
<h1>TensorNodes<a class="headerlink" href="#tensornodes" title="Permalink to this headline">¶</a></h1>
<p>TensorNodes allow you to define parts of your model using TensorFlow, and then
insert those elements into a Nengo model.  TensorNodes work very similarly to a
regular <code class="xref py py-class docutils literal notranslate"><span class="pre">Node</span></code>, except instead of executing arbitrary
Python code they execute arbitrary TensorFlow code.</p>
<p>Here is a simple example that uses a TensorNode to compute a <code class="docutils literal notranslate"><span class="pre">sin</span></code> wave:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">nengo</span>
<span class="kn">import</span> <span class="nn">nengo_dl</span>
<span class="kn">import</span> <span class="nn">tensorflow</span> <span class="kn">as</span> <span class="nn">tf</span>

<span class="k">with</span> <span class="n">nengo</span><span class="o">.</span><span class="n">Network</span><span class="p">()</span> <span class="k">as</span> <span class="n">net</span><span class="p">:</span>
    <span class="n">node</span> <span class="o">=</span> <span class="n">nengo_dl</span><span class="o">.</span><span class="n">TensorNode</span><span class="p">(</span><span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">nengo</span><span class="o">.</span><span class="n">Probe</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>

<span class="k">with</span> <span class="n">nengo_dl</span><span class="o">.</span><span class="n">Simulator</span><span class="p">(</span><span class="n">net</span><span class="p">)</span> <span class="k">as</span> <span class="n">sim</span><span class="p">:</span>
    <span class="n">sim</span><span class="o">.</span><span class="n">run_steps</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>
</pre></div>
</div>
<p>Note that probing and connecting to TensorNodes works in the same way as
regular Nodes.</p>
<p>However, computing <code class="docutils literal notranslate"><span class="pre">sin</span></code> is something we could do with a regular Node.  A
more useful application of TensorNodes is in defining network structures that
are not easily expressed in Nengo, such as convolutional neural networks.
For example, here is a network that applies a convolutional
layer to MNIST images:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">nengo</span>
<span class="kn">import</span> <span class="nn">nengo_dl</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">tensorflow</span> <span class="kn">as</span> <span class="nn">tf</span>
<span class="kn">from</span> <span class="nn">tensorflow.examples.tutorials.mnist</span> <span class="kn">import</span> <span class="n">input_data</span>

<span class="k">class</span> <span class="nc">ConvLayer</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">pre_build</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shape_in</span><span class="p">,</span> <span class="n">shape_out</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_mini</span> <span class="o">=</span> <span class="n">shape_in</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># minibatch size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">img_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">shape_in</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span> <span class="c1"># image height/width</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_channels</span> <span class="o">=</span> <span class="mi">32</span> <span class="c1"># number of convolutional filters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kernel_size</span> <span class="o">=</span> <span class="mi">3</span> <span class="c1"># convolutional filter size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size_out</span> <span class="o">=</span> <span class="n">shape_out</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># output dimensionality</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="c1"># reshape input signal to image shape</span>
        <span class="n">image</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_mini</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_size</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

        <span class="c1"># apply convolutional layer</span>
        <span class="n">conv</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">contrib</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">conv2d</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_channels</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">kernel_size</span><span class="p">)</span>

        <span class="c1"># apply dense layer</span>
        <span class="n">dense</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">contrib</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">conv</span><span class="p">)</span>
        <span class="n">dense</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">contrib</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">fully_connected</span><span class="p">(</span><span class="n">dense</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">size_out</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">dense</span>

<span class="k">with</span> <span class="n">nengo</span><span class="o">.</span><span class="n">Network</span><span class="p">()</span> <span class="k">as</span> <span class="n">net</span><span class="p">:</span>
    <span class="c1"># load input data (mnist images)</span>
    <span class="n">mnist</span> <span class="o">=</span> <span class="n">input_data</span><span class="o">.</span><span class="n">read_data_sets</span><span class="p">(</span><span class="s2">&quot;MNIST_data/&quot;</span><span class="p">)</span>

    <span class="c1"># create node to feed in images</span>
    <span class="n">inp</span> <span class="o">=</span> <span class="n">nengo</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">nengo</span><span class="o">.</span><span class="n">processes</span><span class="o">.</span><span class="n">PresentInput</span><span class="p">(</span><span class="n">mnist</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">images</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

    <span class="c1"># create TensorNode to insert the network defined in `ConvLayer`</span>
    <span class="n">tf_node</span> <span class="o">=</span> <span class="n">nengo_dl</span><span class="o">.</span><span class="n">TensorNode</span><span class="p">(</span><span class="n">ConvLayer</span><span class="p">(),</span> <span class="n">size_in</span><span class="o">=</span><span class="mi">28</span> <span class="o">*</span> <span class="mi">28</span><span class="p">,</span> <span class="n">size_out</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

    <span class="c1"># create connections to/from TensorNodes, or probe their output, just</span>
    <span class="c1"># like a regular Node</span>
    <span class="n">nengo</span><span class="o">.</span><span class="n">Connection</span><span class="p">(</span><span class="n">inp</span><span class="p">,</span> <span class="n">tf_node</span><span class="p">)</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">nengo</span><span class="o">.</span><span class="n">Probe</span><span class="p">(</span><span class="n">tf_node</span><span class="p">)</span>
</pre></div>
</div>
<p>Note that the above example takes advantage of the <code class="docutils literal notranslate"><span class="pre">pre_build</span></code> feature of
TensorNodes.  If the object passed to TensorNode has a <code class="docutils literal notranslate"><span class="pre">pre_build</span></code> function,
NengoDL will call that function once when the model is constructed, and it will
pass in the shape of the input and output Tensors.  This can be used to
define any constants or other operations that don’t need to be executed every
simulation timestep.</p>
<dl class="class">
<dt id="nengo_dl.tensor_node.TensorNode">
<em class="property">class </em><code class="descclassname">nengo_dl.tensor_node.</code><code class="descname">TensorNode</code><span class="sig-paren">(</span><em>tensor_func</em>, <em>size_in=Default</em>, <em>size_out=Default</em>, <em>label=Default</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/nengo_dl/tensor_node.html#TensorNode"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#nengo_dl.tensor_node.TensorNode" title="Permalink to this definition">¶</a></dt>
<dd><p>Inserts TensorFlow code into a Nengo model.  A TensorNode operates in
much the same way as a <code class="xref py py-class docutils literal notranslate"><span class="pre">Node</span></code>, except its inputs and
outputs are defined using TensorFlow operations.</p>
<p>The TensorFlow code is defined in a function or callable class
(<code class="docutils literal notranslate"><span class="pre">tensor_func</span></code>).  This function accepts the current simulation time as
input, or the current simulation time and a Tensor <code class="docutils literal notranslate"><span class="pre">x</span></code> if
<code class="docutils literal notranslate"><span class="pre">node.size_in</span> <span class="pre">&gt;</span> <span class="pre">0</span></code>.  <code class="docutils literal notranslate"><span class="pre">x</span></code> will have shape
<code class="docutils literal notranslate"><span class="pre">(sim.minibatch_size,</span> <span class="pre">node.size_in</span></code>), and the function should return a
Tensor with shape <code class="docutils literal notranslate"><span class="pre">(sim.minibatch_size,</span> <span class="pre">node.size_out)</span></code>.
<code class="docutils literal notranslate"><span class="pre">node.size_out</span></code> will be inferred by calling the function once and
checking the output, if it isn’t set when the Node is created.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">tensor_func</span></code> has a <code class="docutils literal notranslate"><span class="pre">pre_build</span></code> attribute, that function will be
called once when the model is constructed.  This can be used to compute any
constant values or set up variables – things that don’t need to
execute every simulation timestep.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><dl class="first last docutils">
<dt><strong>tensor_func</strong> <span class="classifier-delimiter">:</span> <span class="classifier">callable</span></dt>
<dd><p class="first last">a function that maps node inputs to outputs</p>
</dd>
<dt><strong>size_in</strong> <span class="classifier-delimiter">:</span> <span class="classifier">int, optional (Default: 0)</span></dt>
<dd><p class="first last">the number of elements in the input vector</p>
</dd>
<dt><strong>size_out</strong> <span class="classifier-delimiter">:</span> <span class="classifier">int, optional (Default: None)</span></dt>
<dd><p class="first last">the number of elements in the output vector (if None, value will be
inferred by calling <code class="docutils literal notranslate"><span class="pre">tensor_func</span></code>)</p>
</dd>
<dt><strong>label</strong> <span class="classifier-delimiter">:</span> <span class="classifier">str, optional (Default: None)</span></dt>
<dd><p class="first last">a name for the node, used for debugging and visualization</p>
</dd>
</dl>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="training.html" class="btn btn-neutral float-right" title="Optimizing a NengoDL model" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="simulator.html" class="btn btn-neutral" title="NengoDL Simulator" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Applied Brain Research.
      Last updated on Jun 14, 2018.

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  <!-- adapted from sphinx_rtd_theme versions.html -->

<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
        <span class="fa fa-book"> Versions</span>
        v0.3.0
        <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
        <dl>
            
            
                <dd><a href="../tensor_node.html">latest</a></dd>
            

            
                
                    <dd><a href="../v1.0.0/tensor_node.html">v1.0.0</a></dd>
                
            
                
                    <dd><a href="../v0.6.2/tensor_node.html">v0.6.2</a></dd>
                
            
                
                    <dd><a href="../v0.6.1/tensor_node.html">v0.6.1</a></dd>
                
            
                
                    <dd><a href="../v0.6.0/tensor_node.html">v0.6.0</a></dd>
                
            
                
                    <dd><a href="../v0.5.2/tensor_node.html">v0.5.2</a></dd>
                
            
                
                    <dd><a href="../v0.5.1/tensor_node.html">v0.5.1</a></dd>
                
            
                
                    <dd><a href="../v0.5.0/tensor_node.html">v0.5.0</a></dd>
                
            
                
                    <dd><a href="../v0.4.0/tensor_node.html">v0.4.0</a></dd>
                
            
                
                    <dd><a href="../v0.3.1/tensor_node.html">v0.3.1</a></dd>
                
            
                
                    <dd>v0.3.0</dd>
                
            
                
                    <dd><a href="../v0.2.0/tensor_node.html">v0.2.0</a></dd>
                
            
                
                    <dd><a href="..//tensor_node.html"></a></dd>
                
            
        </dl>
    </div>
</div>

  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.3.0',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  <script type="text/javascript">
      jQuery(function () {
          
          SphinxRtdTheme.Navigation.enableSticky();
          
      });
  </script> 

</body>
</html>