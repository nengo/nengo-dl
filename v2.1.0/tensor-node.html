
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>TensorNodes &#8212; NengoDL documentation</title>
    <link rel="stylesheet" href="_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/css/normalize.css" />
    <link rel="stylesheet" type="text/css" href="_static/css/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="_static/css/mmenu.all.css" />
    <link rel="stylesheet" type="text/css" href="_static/css/components.css" />
    <link rel="stylesheet" type="text/css" href="_static/css/nengo.css" />
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
<!--[if lte IE 9]><script src="https://cdnjs.cloudflare.com/ajax/libs/placeholders/3.0.2/placeholders.min.js"></script><![endif]-->
<script type="text/javascript" src="https://cdn.crate.io/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/js/modernizr.js"></script>
    <script type="text/javascript" src="_static/js/underscore.min.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/js/searchtools.js"></script>
    <script type="text/javascript" src="_static/js/webflow.js"></script>
    <script type="text/javascript" src="_static/js/bootstrap.js"></script>
    <script type="text/javascript" src="_static/js/mmenu.all.min.js"></script>
    <script type="text/javascript" src="_static/js/fontawesome.js"></script>
    <script type="text/javascript" src="_static/js/custom.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="shortcut icon" href="_static/favicon.ico"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Configuration options" href="config.html" />
    <link rel="prev" title="Optimizing a NengoDL model" href="training.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head><body>
<header class="header-nav">
  <div class="container">
    <div class="navbar w-nav" data-animation="default" data-collapse="small" data-contain="1" data-duration="400">
      <a class="brand w-nav-brand" href="https://www.nengo.ai/">
        <img src="https://www.nengo.ai/design/_images/general-full-light.svg" width="120">
      </a>
      <nav class="w-nav-menu main-nav" role="navigation">
        <div class="dropdownBackground">
          <span class="arrow"></span>
        </div>
        <ul id="menu-top-navigation" class="menu">
          <li class="navlink w-nav-link menu-item menu-item-has-children">
            <a href="https://www.nengo.ai/overview.html">Overview</a>
            <ul class="sub-menu">
                <li class="menu-item"><a href="https://www.nengo.ai/quickstart.html">Quick Start</a></li>
            </ul>
          </li>
          <li class="navlink w-nav-link menu-item menu-item-has-children">
            <a href="https://www.nengo.ai/documentation.html">Documentation</a>
            <table class="sub-menu">
              <tr>
                <td class="menu-heading">Core</td>
                <td class="menu-heading">Backends</td>
                <td class="menu-heading">Add-ons</td>
              </tr>
              <tr>
                <td class="menu-item"><a href="https://www.nengo.ai/nengo">Nengo</a></td>
                <td class="menu-item"><a href="https://www.nengo.ai/nengo-fpga">Nengo FPGA</a></td>
                <td class="menu-item"><a href="https://github.com/nengo/nengo-examples">Nengo Examples</a></td>
              </tr>
              <tr>
                <td class="menu-item"><a href="https://www.nengo.ai/nengo-dl/">Nengo DL</a></td>
                <td class="menu-item"><a href="https://www.nengo.ai/nengo-loihi">Nengo Loihi</a></td>
                <td class="menu-item"><a href="https://www.nengo.ai/nengo-extras/">Nengo Extras</a></td>
              </tr>
              <tr>
                <td class="menu-item"><a href="https://github.com/nengo/nengo-gui">Nengo GUI</a></td>
                <td class="menu-item"><a href="https://github.com/nengo/nengo-mpi">Nengo MPI</a></td>
                <td class="menu-item"><a href="https://arvoelke.github.io/nengolib-docs/">Nengo Lib</a></td>
              </tr>
              <tr>
                <td class="menu-item"><a href="https://www.nengo.ai/nengo-spa/">Nengo SPA</a></td>
                <td class="menu-item"><a href="https://github.com/nengo/nengo-ocl">Nengo OpenCL</a></td>
                <td class="menu-item"></td>
              </tr>
              <tr>
                <td class="menu-item"></td>
                <td class="menu-item"><a href="https://github.com/project-rig/nengo_spinnaker">Nengo SpiNNaker</a></td>
                <td class="menu-item"></td>
              </tr>
            </table>
          </li>
          <li class="navlink w-nav-link menu-item menu-item-has-children">
            <a href="https://www.nengo.ai/community.html">Community</a>
            <ul class="sub-menu">
              <li class="menu-item"><a href="https://forum.nengo.ai/">Forum</a></li>
              <li class="menu-item"><a href="https://www.nengo.ai/publications.html">Publications</a></li>
              <li class="menu-item"><a href="https://www.nengo.ai/summerschool.html">Summer School</a></li>
              <li class="menu-item"><a href="https://www.nengo.ai/videos.html">Videos</a></li>
              <li class="menu-item"><a href="https://www.nengo.ai/people.html">People</a></li>
            </ul>
          </li>
          <li class="navlink w-nav-link menu-item menu-item-has-children">
            <a href="https://www.nengo.ai/projects.html">Development</a>
            <ul class="sub-menu">
              <li class="menu-item"><a href="https://www.nengo.ai/contributing.html">Contributor Guide</a></li>
              <li class="menu-item"><a href="https://www.nengo.ai/projects.html">Ecosystem</a></li>
            </ul>
          </li>
          <li class="navlink w-nav-link menu-item"><a href="https://www.nengo.ai/README.html">About</a></li>
          <li class="btn-link w-nav-link menu-item"><a href="https://www.nengo.ai/download.html">Download</a></li>
        </ul>
      </nav>

      <div id="mobile-nav" class="mm-menu">
        <ul class="offcanvas-menu">
          <li class="navlink w-nav-link menu-item"><a href="https://www.nengo.ai/overview.html">Overview</a></li>
          <li class="navlink w-nav-link menu-item menu-item-has-children">
            <a href="https://www.nengo.ai/documentation.html">Documentation</a>
            <ul class="sub-menu">
              <li class="menu-item"><a href="https://www.nengo.ai/quickstart.html">Quick Start</a></li>
              <li class="menu-item"><a href="http://www.nengo.ai/nengo">NengoCore</a></li>
              <li class="menu-item"><a href="https://github.com/nengo/nengo-gui#nengo-gui">NengoGUI</a></li>
            </ul>
          </li>
          <li class="navlink w-nav-link menu-item menu-item-has-children">
            <a href="https://www.nengo.ai/community.html">Community</a>
            <ul class="sub-menu">
              <li class="menu-item"><a href="https://forum.nengo.ai/">Forum</a></li>
              <li class="menu-item"><a href="https://www.nengo.ai/summerschool.html">Summer School</a></li>
              <li class="menu-item"><a href="https://www.nengo.ai/people.html">People</a></li>
            </ul>
          </li>
          <li class="navlink w-nav-link menu-item menu-item-has-children">
            <a href="https://www.nengo.ai/projects.html">Development</a>
            <ul class="sub-menu">
              <li class="menu-item"><a href="https://www.nengo.ai/contributing.html">Contributor Guide</a></li>
              <li class="menu-item"><a href="https://www.nengo.ai/projects.html">Ecosystem</a></li>
            </ul>
          </li>
          <li class="navlink w-nav-link menu-item"><a href="https://www.nengo.ai/README.html">About</a></li>
          <li class="btn-link w-nav-link menu-item"><a href="https://www.nengo.ai/download.html">Download</a></li>
        </ul>
      </div>

      <a href="#mobile-nav" class="fa fa-bars mobile-nav-button"></a>
    </div>
  </div>
</header>

<div class="w-section section border-top">
  <div class="container">
    <div class="row" id="tensor-node">
      <div class="col-md-4 col-lg-3">
        <aside class="wrapper-navleft"><div role="complementary" class="bs-docs-sidebar hidden-print" id="nav-affix">
  <ul class="bs-docs-sidenav bs-sidenav nav" role="complementary">
    <a href="index.html">
      <img class="logo" src="https://www.nengo.ai/design/_images/nengo-dl-full-light.svg" alt="NengoDL" width="200" />
    </a>
    <ul class="toctree nav nav-list">
      <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="user-guide.html">User guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="simulator.html">NengoDL Simulator</a></li>
<li class="toctree-l2"><a class="reference internal" href="training.html">Optimizing a NengoDL model</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">TensorNodes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#examples">Examples</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="config.html">Configuration options</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="reference.html">API reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="resources.html">Additional resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="project.html">Project information</a></li>
</ul>

    </ul>
  </ul>
</div>
          
        </aside>
      </div>
      <div class="col-md-8 col-lg-9">
        <div class="wrapper-content-right">
          
<div class="version-select-container">
    <div data-delay="0" class="w-dropdown">
        <div class="w-dropdown-toggle toggle">
            <div class="toggle-text">v2.1.0</div>
            <div class="w-icon-dropdown-toggle toggle-icon"></div>
        </div>
        <nav class="w-dropdown-list dropdown-list">
            
            
                <a href="../tensor-node.html" class="w-dropdown-link">latest</a>
            

            
                
                <div class="w-dropdown-link">v2.1.0</div>
                
            
                
                    <a href="../v2.0.0/tensor-node.html" class="w-dropdown-link">v2.0.0</a>
                
            
                
                    <a href="../v1.2.1/tensor-node.html" class="w-dropdown-link">v1.2.1</a>
                
            
                
                    <a href="../v1.2.0/tensor-node.html" class="w-dropdown-link">v1.2.0</a>
                
            
                
                    <a href="../v1.1.0/tensor-node.html" class="w-dropdown-link">v1.1.0</a>
                
            
                
                    <a href="../v1.0.0/tensor-node.html" class="w-dropdown-link">v1.0.0</a>
                
            
                
                    <a href="../v0.6.2/tensor-node.html" class="w-dropdown-link">v0.6.2</a>
                
            
                
                    <a href="../v0.6.1/tensor-node.html" class="w-dropdown-link">v0.6.1</a>
                
            
                
                    <a href="../v0.6.0/tensor-node.html" class="w-dropdown-link">v0.6.0</a>
                
            
                
                    <a href="../v0.5.2/tensor-node.html" class="w-dropdown-link">v0.5.2</a>
                
            
                
                    <a href="../v0.5.1/tensor-node.html" class="w-dropdown-link">v0.5.1</a>
                
            
                
                    <a href="../v0.5.0/tensor-node.html" class="w-dropdown-link">v0.5.0</a>
                
            
                
                    <a href="../v0.4.0/tensor-node.html" class="w-dropdown-link">v0.4.0</a>
                
            
                
                    <a href="../v0.3.1/tensor-node.html" class="w-dropdown-link">v0.3.1</a>
                
            
                
                    <a href="../v0.3.0/tensor-node.html" class="w-dropdown-link">v0.3.0</a>
                
            
                
                    <a href="../v0.2.0/tensor-node.html" class="w-dropdown-link">v0.2.0</a>
                
            
        </nav>
    </div>
</div>

          
  <div class="section" id="tensornodes">
<h1>TensorNodes<a class="headerlink" href="#tensornodes" title="Permalink to this headline">¶</a></h1>
<p>TensorNodes allow parts of a model to be defined using TensorFlow and smoothly
integrated with the rest of a Nengo model.  TensorNodes work very similarly to
a regular <a class="reference external" href="https://www.nengo.ai/nengo/frontend_api.html#nengo.Node" title="(in Nengo v2.8)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Node</span></code></a>, except instead of executing arbitrary
Python code they execute arbitrary TensorFlow code.</p>
<p>The TensorFlow code is defined in a function or callable class
(<code class="docutils literal notranslate"><span class="pre">tensor_func</span></code>).  This function accepts the current simulation time as
input, or the current simulation time and a Tensor <code class="docutils literal notranslate"><span class="pre">x</span></code> if
<code class="docutils literal notranslate"><span class="pre">node.size_in</span> <span class="pre">&gt;</span> <span class="pre">0</span></code>.  <code class="docutils literal notranslate"><span class="pre">x</span></code> will have shape
<code class="docutils literal notranslate"><span class="pre">(sim.minibatch_size,</span> <span class="pre">node.size_in</span></code>), and the function should return a
Tensor with shape <code class="docutils literal notranslate"><span class="pre">(sim.minibatch_size,</span> <span class="pre">node.size_out)</span></code>.
<code class="docutils literal notranslate"><span class="pre">node.size_out</span></code> will be inferred by calling the function once and
checking the output, if it isn’t set when the Node is created.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">tensor_func</span><span class="p">(</span><span class="n">t</span> <span class="p">[,</span> <span class="n">x</span><span class="p">]):</span>
    <span class="k">print</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>  <span class="c1"># current simulation time</span>
    <span class="k">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>  <span class="c1"># input on current timestep (minibatch_size, node.size_in)</span>

    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span>
</pre></div>
</div>
<p>If <code class="docutils literal notranslate"><span class="pre">tensor_func</span></code> has a <code class="docutils literal notranslate"><span class="pre">pre_build</span></code> attribute, that function will be
called once when the model is constructed.  This can be used to compute any
constant values or set up variables – things that don’t need to
execute every simulation timestep.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">pre_build</span><span class="p">(</span><span class="n">shape_in</span><span class="p">,</span> <span class="n">shape_out</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="n">shape_in</span><span class="p">)</span>  <span class="c1"># (minibatch_size, node.size_in)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">shape_out</span><span class="p">)</span>  <span class="c1"># (minibatch_size, node.size_out)</span>
</pre></div>
</div>
<p>If <code class="docutils literal notranslate"><span class="pre">tensor_func</span></code> has a <code class="docutils literal notranslate"><span class="pre">post_build</span></code> attribute, that function will be
called after the simulator is created and whenever it is reset.  This can
be used to set any random elements in the TensorNode or perform any
post-initialization setup required by the node (e.g., loading pretrained
weights).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">post_build</span><span class="p">(</span><span class="n">sess</span><span class="p">,</span> <span class="n">rng</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="n">sess</span><span class="p">)</span>  <span class="c1"># the TensorFlow simulation session object</span>
    <span class="k">print</span><span class="p">(</span><span class="n">rng</span><span class="p">)</span>  <span class="c1"># random number generator (np.random.RandomState)</span>
</pre></div>
</div>
<p><a class="reference internal" href="reference.html#nengo_dl.tensor_node.tensor_layer" title="nengo_dl.tensor_node.tensor_layer"><code class="xref py py-obj docutils literal notranslate"><span class="pre">tensor_layer</span></code></a> is a utility function for constructing TensorNodes,
designed to mimic the layer-based model construction style of many deep
learning packages.  It combines the creation of a <a class="reference internal" href="reference.html#nengo_dl.tensor_node.TensorNode" title="nengo_dl.tensor_node.TensorNode"><code class="xref py py-obj docutils literal notranslate"><span class="pre">TensorNode</span></code></a> or
<a class="reference external" href="https://www.nengo.ai/nengo/frontend_api.html#nengo.Ensemble" title="(in Nengo v2.8)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Ensemble</span></code></a> and a <a class="reference external" href="https://www.nengo.ai/nengo/frontend_api.html#nengo.Connection" title="(in Nengo v2.8)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Connection</span></code></a> in a single step.</p>
<p>See the <a class="reference internal" href="reference.html#tensornode-api"><span class="std std-ref">TensorNode API</span></a> for more details, or the
examples below for demonstrations of using TensorNodes in practice.</p>
<div class="section" id="examples">
<h2>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><a class="reference internal" href="examples/pretrained-model.html"><span class="doc">Inserting a TensorFlow network into a Nengo model</span></a></li>
<li><a class="reference internal" href="examples/spiking-mnist.html"><span class="doc">Optimizing spiking neural networks</span></a></li>
</ul>
</div>
</div>


        </div>
      </div>
    </div>
  </div>
</div><footer class="footer">
  <div class="w-container">
    <div class="w-clearfix">
      <div class="w-row mobileAlign">
        <div class="w-col w-col-2 footer-menu">
          <p class="menu-Label">ABR, Inc.</p>
          <ul class="vertical-menu">
            <li class="footer-listitem-new"><a href="https://appliedbrainresearch.com/products/">Products</a></li>
            <li class="footer-listitem-new "><a href="https://appliedbrainresearch.com/services/">Services</a></li>
            <li class="footer-listitem-new"><a href="https://appliedbrainresearch.com/research/">Research</a></li>
          </ul>
        </div>
        <div class="w-col w-col-2 footer-menu">
          <p class="menu-Label">About Us</p>
          <ul class="vertical-menu">
            <li class="footer-listitem-new"><a href="https://appliedbrainresearch.com/about-us/">Contact</a></li>
            <li class="footer-listitem-new"><a href="https://appliedbrainresearch.com/about-us/#team">Team</a></li>
            <li class="footer-listitem-new"><a href="https://appliedbrainresearch.com/about-us/#culture">Culture</a></li>
          </ul>
        </div>
        <a class="brand footer-brand" href="https://appliedbrainresearch.com">
          <img src="https://appliedbrainresearch.com/img/logo-light-notext.svg" width="80">
        </a>
      </div>
    </div>
  </div>
</footer>
  </body>
</html>